# HikeAllocator

## Назначение

Инструмент для автоматического распределения общественного снаряжения и продуктов питания между участниками в многодневном походе.
Алгоритм пытается (с возможной погрешностью) справедливо разделить общественный вес среди участников похода.  
Критерием справедливости является не вес, который несет участник, а параметр `Работа`, который определяется как `Вес (кг) х Длительность (дни)`. Например, нести палатку весом 5 кг 1 день эквивалентно по выполненной работе ношению аптечки весом 1 кг в течение 5 дней (`5 * 1 (кг*дн) == 1 * 5 (кг*дн`), хотя при этом просто по весу палатка в 5 раз тяжелее.  

## Как использовать

### С помощью GoogleSheet

Создан документ GoogleSheet, в котором есть вкладки `Данные похода` и `Распределение`. Первая вкладка содержит:

**Таблицы с данными похода**
* Длительность (количество дней)
* Участники
* Снаряжение
* Еда

**Команды (действия)**
* `Распределить` - распределяет вес и выводит итоговую таблицу во вкладку `Распределение`
* `Добавить участника` - добавляет нового участника в конец таблицы участников
* `Добавить снаряжение` - добавляет новое снаряжение в конец таблицы снаряжения
* `Добавить еду` - добавляет новую строку с едой в конец таблицы продуктов питания

Для расчета распределения необходимо заполнить таблицы данными вашего похода и затем выполнить команду `Распределить`.  
Команды находятся в выпадающем списке справа от `Выберите действие` (ячейка B2). 
Выполнять данные действия можно как с веб-версии гугл таблиц (с десктопа или смартфона), так и с приложения на телефоне. В случае проблем с распределением через мобильное приложение можно открыть гугл-таблицу в мобильном браузере как десктопную версию (это нужно отметить в настройках страницы) и выполнять команды оттуда. Данные похода при этом можно по прежнему заполнять в приложении, так как это удобнее.
При изменении данных распределение не пересчитывается автоматически. Необходимо заново выполнять команду.  
Полученную в результате распределения таблицу можно распечатать и использовать в походе. Либо можно вручную перенести данные из нее на листок бумаги при отсутсвии возможности распечатать.  

**Корректность ввода данных**
Все ячейки таблиц являются обязательные для заполнения, кроме колонки `Несет` таблицы участников похода, так как не обязательно, что какое-то снаряжение изначально закреплено за участником. Также обязательным является наличие хотя бы одного участника и снаряжения/еды, так как без этих данных распределение невозможно.  
В таблицах ввода данных настроены валидации, которые запретят вводить некорректные данные.  
В случае, если какие-то данные не заполнены ошибки выведутся при выполнении команды `Распределить`.

#### Описание таблиц
**Количество дней**  
Заполняется длительность похода в днях, число больше 0.

**Участники**  
Заполняется список участников похода с параметрами:
* `Участник` - ФИО участника (или любое другое обозначение)
* `Весовой коэф` - весовой коэффициент, значение от 0 до 1. Необходимо для учета того, что некоторые участники несут меньше веса. Базовый коэффициент - 1 (100%). Например, женщины несут 70% от того веса, который несут мужчины, значит для мужчин коэффициент равен 1, для женщин 0.7.
* `Несет` - список снаряжения, которое уже зафиксировано за участником до распределения. Например, участник несет свою собственную палатку. Заполняется списком названий предметов из колонки `Снаряжение` таблицы `Снаряжение`, разделенных запятой. Название должно в точности совпадать с названием из таблицы снаряжения.

**Снаряжение**  
Заполняется список общественного снаряжения для похода. Параметры:
* `Снаряжение` - название снаряжения, любая строка.
* `Нести (дн)` - количество дней, которое нужно пронести снаряжение. Обычно это число равно количеству дней похода (палатку/котлы несем вес поход). Такие предметы как газ могут закончиться до окончания похода и иметь другое значение.
* `Вес (кг)` - вес снаряжения в килограммах

**Еда**  
Заполняется список общественных продуктов питания или приемов пищи для похода. Параметры:
* `Еда` - название, любая строка, например `Завтрак`. Завтраки, ужины и т.д. можно не называть с пометкой номера дня (например `Завтрак 2`), а оставить просто `Завтрак`. Суффикс с нужным днем подставится автоматически.
* `Нести (дн)` - количество дней, которое нужно пронести продукт. Например, сахар надо нести весь поход, ужин 5 дня - 5 дней, завтрак 7 дня - 6 дней.
* `Вес (кг)` - вес продуктов/приема пищи в килограммах
* `Тип потребления`
  * `Fixed` - продукт/снаряжение несется какое-то количество дней, и затем полностью расходуется. Напримен ужин 6 дня. Этот тип значения также используется по умолчанию для снаряжения, т.е ужин последнего дня похода эквивалентен палатке, так как оба этих предмета надо нести до конца похода.
  * `FixedNextDay` - подтип предыдущего типа, используетя в основном для завтраков, так как их потребяют на следующий день. Завтрак в таблице распределения надо отобразить в 6 день, а нести его - 5 дней.
  * `Linear` - используется для сыпучих/штучных/постепенно заканчивающихся продуктов, например сахар, сыр и т.д. Такие продукты постепенно расходуются в процессе похода и в идеале должны закончиться в конце. Работа в таких случаях вычисляется по формуле `Вес (кг) * (Длительность (дн) + 1) / 2`.

### С помощью NodeJs

Более технический способ. Необходимо:
* Создать или отредактировать существующий json-файл с данными похода (длительность, участники, предметы) в папке `/examples` (либо в любом другом месте)
* Подключить данный файл в приложение `nodeApp.js` (в самом начале файла)
* Из корня приложения выполнить команду `node ./nodeApp.js`

Для работы необходим установленный `NodeJs`.

В результате в консоль выведутся данные о распределении предметов, которые затем можно использовать, например вручную перенести на лист бумаги.



